<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>STYLE MATCHER âˆž | Visual Intelligence v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.0/lucide.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-bg: #030617;
            --brand-accent: #FF8201;
            --brand-white: #FFFFFF;
            --brand-gray: #1E293B;
            --brand-dark: #0F172A;
        }

        body {
            background-color: var(--brand-bg);
            color: var(--brand-white);
            font-family: 'Inter', sans-serif;
            margin: 0;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        .heading-font { font-family: 'Space Grotesk', sans-serif; }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* DNA Components */
        .dna-bar {
            height: 6px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            overflow: hidden;
        }

        .dna-fill {
            height: 100%;
            background: var(--brand-accent);
            width: 0%;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Color Cards */
        .color-slot {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
        }

        .color-slot:hover { transform: scale(1.05); z-index: 10; }

        /* Simulations */
        .sim-container {
            aspect-ratio: 1/1;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
            background: #000;
        }

        .noise {
            position: absolute;
            inset: 0;
            opacity: 0.05;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
        }

        /* Controls */
        .toggle-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 10px;
            text-transform: uppercase;
            font-weight: 700;
            transition: all 0.2s;
        }

        .toggle-btn.active {
            background: var(--brand-accent);
            color: #000;
            border-color: var(--brand-accent);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: var(--brand-bg); }
        ::-webkit-scrollbar-thumb { background: var(--brand-gray); border-radius: 10px; }

        @media (max-width: 1024px) {
            .mobile-stack { flex-direction: column; }
        }

        canvas { display: none; }
    </style>
</head>
<body class="min-h-screen">

    <!-- TOP NAVIGATION -->
    <header class="fixed top-0 w-full z-[60] glass-panel px-6 py-4 flex justify-between items-center border-b border-white/5">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-[#FF8201] rounded-lg flex items-center justify-center shadow-[0_0_20px_rgba(255,130,1,0.3)]">
                <i data-lucide="blocks" class="text-black w-6 h-6"></i>
            </div>
            <div>
                <h1 class="heading-font font-bold text-lg tracking-tighter uppercase leading-none">Style Matcher</h1>
                <p class="text-[9px] uppercase tracking-[0.3em] opacity-40 mt-1">Infinity Engine v2.0</p>
            </div>
        </div>

        <div class="flex gap-2 items-center">
            <button id="btn-reset" onclick="resetEngine()" class="hidden sm:flex items-center gap-2 text-[10px] uppercase font-bold opacity-50 hover:opacity-100 px-3 py-2">
                <i data-lucide="refresh-cw" class="w-3 h-3"></i> Clear
            </button>
            <button onclick="toggleClientMode()" class="flex items-center gap-2 text-[10px] uppercase font-bold bg-white/10 hover:bg-white/20 px-4 py-2 rounded-full transition-all">
                <i data-lucide="presentation" class="w-3 h-3"></i> <span class="hidden xs:inline">Preview Mode</span>
            </button>
            <button onclick="window.print()" class="bg-[#FF8201] text-black px-4 py-2 rounded-full text-[10px] font-bold uppercase tracking-widest shadow-lg shadow-[#FF8201]/20">
                Export
            </button>
        </div>
    </header>

    <main class="pt-28 pb-12 px-4 max-w-[1800px] mx-auto">
        <div class="grid grid-cols-12 gap-6">
            
            <!-- LEFT: INPUT & DNA -->
            <aside class="col-span-12 lg:col-span-3 space-y-6">
                <!-- Dropzone -->
                <div id="drop-zone" class="glass-panel p-8 rounded-3xl border-2 border-dashed border-white/10 text-center cursor-pointer hover:border-[#FF8201]/50 transition-all group">
                    <input type="file" id="file-input" multiple class="hidden" accept="image/*">
                    <div class="space-y-3">
                        <div class="w-12 h-12 bg-white/5 rounded-2xl flex items-center justify-center mx-auto group-hover:scale-110 transition-transform">
                            <i data-lucide="plus" class="text-[#FF8201] w-6 h-6"></i>
                        </div>
                        <p class="text-sm font-bold uppercase tracking-tight">Source Reference</p>
                        <p class="text-[10px] opacity-40 uppercase tracking-widest">Drop up to 5 images</p>
                    </div>
                </div>

                <!-- Preview Grid -->
                <div id="img-previews" class="grid grid-cols-5 gap-2"></div>

                <!-- DNA Panel -->
                <div class="glass-panel p-6 rounded-3xl space-y-6">
                    <div class="flex justify-between items-center">
                        <h3 class="text-[10px] font-black uppercase tracking-widest text-[#FF8201]">Aesthetic DNA</h3>
                        <div id="status-tag" class="text-[8px] px-2 py-0.5 rounded bg-white/5 border border-white/10 opacity-50">IDLE</div>
                    </div>

                    <div class="space-y-4" id="dna-container">
                        <div class="space-y-2">
                            <div class="flex justify-between text-[9px] uppercase font-bold opacity-40">
                                <span>Organic</span><span>Geometric</span>
                            </div>
                            <div class="dna-bar"><div id="dna-geo" class="dna-fill"></div></div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-[9px] uppercase font-bold opacity-40">
                                <span>Muted</span><span>Saturation</span>
                            </div>
                            <div class="dna-bar"><div id="dna-sat" class="dna-fill"></div></div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-[9px] uppercase font-bold opacity-40">
                                <span>Dark Mode</span><span>High Light</span>
                            </div>
                            <div class="dna-bar"><div id="dna-lum" class="dna-fill"></div></div>
                        </div>
                    </div>

                    <div class="pt-4 border-t border-white/5">
                        <div id="style-title" class="text-xs font-bold text-[#FF8201] mb-2 uppercase tracking-tighter">Analysis Pending</div>
                        <p id="style-narrative" class="text-[11px] leading-relaxed opacity-50 italic">Feed the engine visual data to generate a strategy narrative.</p>
                    </div>
                </div>
            </aside>

            <!-- CENTER: COLOR ENGINE -->
            <section class="col-span-12 lg:col-span-6 space-y-6">
                <div class="glass-panel p-8 rounded-3xl min-h-[600px] flex flex-col">
                    <div class="flex justify-between items-center mb-10">
                        <div>
                            <h3 class="text-xs font-black uppercase tracking-widest">Extracted Palette</h3>
                            <p class="text-[10px] opacity-40 mt-1">Based on k-means clustering frequency</p>
                        </div>
                        <div class="flex gap-1" id="mode-toggles">
                            <button onclick="setStrategy('editorial')" class="toggle-btn active" data-mode="editorial">Editorial</button>
                            <button onclick="setStrategy('modern')" class="toggle-btn" data-mode="modern">Modern</button>
                            <button onclick="setStrategy('vibrant')" class="toggle-btn" data-mode="vibrant">Vibrant</button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                        <div class="space-y-4">
                            <p class="text-[9px] font-bold uppercase tracking-[0.2em] opacity-30">Dominant Foundation</p>
                            <div id="primary-slots" class="grid grid-cols-2 gap-4">
                                <div class="h-32 rounded-2xl bg-white/5 animate-pulse"></div>
                                <div class="h-32 rounded-2xl bg-white/5 animate-pulse"></div>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <p class="text-[9px] font-bold uppercase tracking-[0.2em] opacity-30">Sub-Dominant Palette</p>
                            <div id="secondary-slots" class="grid grid-cols-3 gap-2">
                                <div class="aspect-square rounded-xl bg-white/5 animate-pulse"></div>
                                <div class="aspect-square rounded-xl bg-white/5 animate-pulse"></div>
                                <div class="aspect-square rounded-xl bg-white/5 animate-pulse"></div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4 mt-auto">
                        <div class="flex justify-between items-center">
                            <p class="text-[9px] font-bold uppercase tracking-[0.2em] opacity-30">Structural Neutrals</p>
                            <span class="text-[8px] opacity-20 uppercase">Achromatic Safety</span>
                        </div>
                        <div id="neutral-slots" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>

                <!-- Strategic Advisory -->
                <div class="bg-[#FF8201]/10 border border-[#FF8201]/20 p-6 rounded-3xl flex items-start gap-5">
                    <div class="w-10 h-10 bg-[#FF8201] rounded-full flex items-center justify-center shrink-0">
                        <i data-lucide="info" class="text-black w-5 h-5"></i>
                    </div>
                    <div>
                        <h4 class="text-sm font-black text-[#FF8201] uppercase tracking-tighter">Strategic Intelligence</h4>
                        <p id="advisory-text" class="text-xs opacity-80 mt-1 leading-relaxed">System awaiting data input. Upload project references to begin visual cross-analysis and market positioning.</p>
                    </div>
                </div>
            </section>

            <!-- RIGHT: SIMULATIONS & METRICS -->
            <aside class="col-span-12 lg:col-span-3 space-y-6">
                <!-- Simulation Grid -->
                <div class="glass-panel p-6 rounded-3xl">
                    <h3 class="text-[10px] font-black uppercase tracking-widest mb-6 opacity-40">Environment Sims</h3>
                    
                    <div class="space-y-6">
                        <div id="sim-poster" class="sim-container p-8 flex flex-col justify-end">
                            <div class="noise"></div>
                            <div class="relative z-10">
                                <div id="poster-accent" class="w-12 h-1 rounded-full mb-3"></div>
                                <div id="poster-title" class="w-full h-4 rounded-sm mb-2 opacity-80"></div>
                                <div id="poster-body" class="w-2/3 h-2 rounded-sm opacity-40"></div>
                            </div>
                            <div class="absolute top-6 right-6 text-[8px] font-bold tracking-[0.3em] opacity-20 rotate-90 origin-right">MOCK_POSTER_01</div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div id="sim-app" class="sim-container p-4 flex flex-col items-center justify-center gap-4">
                                <div id="app-btn" class="w-full h-10 rounded-xl shadow-xl flex items-center justify-center text-[8px] font-bold">BUTTON</div>
                                <div class="w-1/2 h-1 rounded-full bg-white/10"></div>
                            </div>
                            <div id="sim-package" class="sim-container bg-white flex items-center justify-center p-6">
                                <div id="pkg-circle" class="w-full aspect-square border-4 border-dashed rounded-full flex items-center justify-center">
                                    <span class="text-[10px] font-black text-black/20 tracking-widest">BRAND</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Accessibility Metrics -->
                <div class="glass-panel p-6 rounded-3xl space-y-5">
                    <h3 class="text-[10px] font-black uppercase tracking-widest opacity-40">Accessibility Audit</h3>
                    <div id="a11y-metrics" class="space-y-4">
                        <div class="flex justify-between items-center text-[10px] font-bold">
                            <span class="opacity-40">AA CONTRAST</span>
                            <span id="metric-aa" class="text-white/20">--</span>
                        </div>
                        <div class="flex justify-between items-center text-[10px] font-bold">
                            <span class="opacity-40">LUMINANCE</span>
                            <span id="metric-lum" class="text-white/20">--</span>
                        </div>
                        <div class="flex justify-between items-center text-[10px] font-bold">
                            <span class="opacity-40">VIBRANCY</span>
                            <span id="metric-vib" class="text-white/20">--</span>
                        </div>
                    </div>
                </div>
            </aside>

        </div>
    </main>

    <!-- FULLSCREEN PREVIEW -->
    <div id="preview-overlay" class="fixed inset-0 bg-[#030617] z-[100] hidden flex-col overflow-y-auto">
        <div class="p-8 sm:p-20 max-w-6xl mx-auto w-full space-y-20">
            <nav class="flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-[#FF8201] rounded-2xl flex items-center justify-center">
                        <i data-lucide="eye" class="text-black w-6 h-6"></i>
                    </div>
                    <h2 class="heading-font text-2xl font-black uppercase">Vision Directive</h2>
                </div>
                <button onclick="toggleClientMode()" class="w-12 h-12 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center">
                    <i data-lucide="x"></i>
                </button>
            </nav>

            <header class="space-y-12">
                <h3 id="preview-headline" class="text-5xl sm:text-8xl font-light heading-font leading-none tracking-tighter">
                    Synthetic <span class="italic font-bold">Intelligence</span> Meets <span class="italic font-bold">Brand</span>.
                </h3>
                <div id="preview-palette" class="h-64 flex rounded-3xl overflow-hidden shadow-2xl border border-white/5"></div>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-16 pb-20">
                <div class="space-y-6">
                    <div class="text-[10px] font-black uppercase tracking-[0.5em] text-[#FF8201]">Positioning Summary</div>
                    <p id="preview-desc" class="text-2xl font-light leading-relaxed opacity-60">Your visual references suggest a sophisticated market alignment. This directive emphasizes high-impact saturation balanced with timeless structural neutrals.</p>
                </div>
                <div class="flex items-center justify-between p-12 bg-white/5 rounded-[40px] border border-white/10">
                    <div>
                        <p class="text-[10px] font-bold uppercase opacity-40 mb-1">Industry Synergy</p>
                        <p class="text-6xl font-black heading-font text-[#FF8201]">92%</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] font-bold uppercase opacity-40 mb-1">Visual Longevity</p>
                        <p class="text-6xl font-black heading-font text-white">High</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <canvas id="engine-canvas"></canvas>

    <script>
        // CORE STATE
        const state = {
            images: [],
            palette: [],
            dna: { geo: 0, sat: 0, lum: 0 },
            strategy: 'editorial',
            isProcessing: false
        };

        // INITIALIZE
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof lucide !== 'undefined') lucide.createIcons();
            setupInteractions();
        });

        function setupInteractions() {
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');

            dropZone.onclick = () => fileInput.click();
            fileInput.onchange = (e) => handleUpload(e.target.files);
            
            dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('border-[#FF8201]'); };
            dropZone.ondragleave = () => dropZone.classList.remove('border-[#FF8201]');
            dropZone.ondrop = (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-[#FF8201]');
                handleUpload(e.dataTransfer.files);
            };
        }

        async function handleUpload(files) {
            if (state.isProcessing) return;
            state.isProcessing = true;
            
            const fileList = Array.from(files).slice(0, 5);
            state.images = [];
            const previews = document.getElementById('img-previews');
            previews.innerHTML = '';
            
            for (const file of fileList) {
                const url = URL.createObjectURL(file);
                const img = new Image();
                img.src = url;
                await new Promise(r => img.onload = r);
                state.images.push(img);
                
                const d = document.createElement('div');
                d.className = "aspect-square rounded-lg border border-white/10 bg-center bg-cover shadow-lg hover:scale-105 transition-all";
                d.style.backgroundImage = `url(${url})`;
                previews.appendChild(d);
            }

            if (state.images.length > 0) processVisuals();
            state.isProcessing = false;
            document.getElementById('btn-reset').classList.remove('hidden');
        }

        function processVisuals() {
            const canvas = document.getElementById('engine-canvas');
            const ctx = canvas.getContext('2d');
            let pixels = [];

            state.images.forEach(img => {
                const s = 100;
                canvas.width = s; canvas.height = s;
                ctx.drawImage(img, 0, 0, s, s);
                const d = ctx.getImageData(0, 0, s, s).data;
                for (let i = 0; i < d.length; i += 32) pixels.push([d[i], d[i+1], d[i+2]]);
            });

            state.palette = clusterColors(pixels, 10);
            calculateDNA(pixels);
            updateUI();
        }

        // K-MEANS ENGINE
        function clusterColors(pixels, k) {
            let centers = pixels.slice(0, k);
            for (let i = 0; i < 5; i++) {
                let clusters = Array.from({length: k}, () => []);
                pixels.forEach(p => {
                    let min = Infinity, idx = 0;
                    centers.forEach((c, j) => {
                        let d = Math.hypot(p[0]-c[0], p[1]-c[1], p[2]-c[2]);
                        if (d < min) { min = d; idx = j; }
                    });
                    clusters[idx].push(p);
                });
                centers = clusters.map(c => c.length ? [
                    c.reduce((a,b)=>a+b[0],0)/c.length,
                    c.reduce((a,b)=>a+b[1],0)/c.length,
                    c.reduce((a,b)=>a+b[2],0)/c.length
                ] : [0,0,0]);
            }
            return centers.map(c => `rgb(${Math.round(c[0])}, ${Math.round(c[1])}, ${Math.round(c[2])})`);
        }

        function calculateDNA(pixels) {
            let l = 0, s = 0, geo = 0;
            pixels.forEach(p => {
                const max = Math.max(...p), min = Math.min(...p);
                l += (max / 255);
                s += (max === 0 ? 0 : (max - min) / max);
                // Check for "geometric" sharpness (simplified)
                if (Math.abs(p[0]-p[1]) < 10 && Math.abs(p[1]-p[2]) < 10) geo += 1;
            });
            const c = pixels.length;
            state.dna.lum = (l / c) * 100;
            state.dna.sat = (s / c) * 100;
            state.dna.geo = (geo / c) * 100;
        }

        function updateUI() {
            // DNA Bars
            document.getElementById('dna-lum').style.width = state.dna.lum + '%';
            document.getElementById('dna-sat').style.width = state.dna.sat + '%';
            document.getElementById('dna-geo').style.width = state.dna.geo + '%';
            document.getElementById('status-tag').innerText = "CALIBRATED";
            document.getElementById('status-tag').classList.add('bg-[#FF8201]/20', 'text-[#FF8201]');

            // Sort colors by luminance
            const colors = [...state.palette].sort((a,b) => getLuminance(b) - getLuminance(a));
            
            const pri = [colors[0], colors[1]];
            const sec = colors.slice(2, 5);
            const neu = colors.slice(5);

            renderSlots('primary-slots', pri, 'h-32 rounded-2xl');
            renderSlots('secondary-slots', sec, 'aspect-square rounded-xl');
            renderSlots('neutral-slots', neu, 'w-10 h-10 rounded-lg');

            applyStrategy(pri[0], sec[0], neu[neu.length-1]);
            auditAccessibility(pri[0], colors[colors.length-1]);
        }

        function renderSlots(id, colors, css) {
            const container = document.getElementById(id);
            container.innerHTML = '';
            colors.forEach(c => {
                const div = document.createElement('div');
                div.className = `color-slot ${css} border border-white/10 shadow-xl overflow-hidden group`;
                div.style.backgroundColor = c;
                div.innerHTML = `<div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center text-[8px] font-bold">COPY</div>`;
                div.onclick = () => copyText(c);
                container.appendChild(div);
            });
        }

        function setStrategy(mode) {
            state.strategy = mode;
            document.querySelectorAll('#mode-toggles button').forEach(b => {
                b.classList.toggle('active', b.dataset.mode === mode);
            });
            if (state.palette.length > 0) updateUI();
        }

        function applyStrategy(pri, sec, neu) {
            const title = document.getElementById('style-title');
            const narr = document.getElementById('style-narrative');
            const adv = document.getElementById('advisory-text');

            // Simulations
            document.getElementById('sim-poster').style.backgroundColor = pri;
            document.getElementById('poster-accent').style.backgroundColor = sec;
            document.getElementById('poster-title').style.backgroundColor = neu;
            document.getElementById('poster-body').style.backgroundColor = neu;
            document.getElementById('app-btn').style.backgroundColor = sec;
            document.getElementById('app-btn').style.color = getLuminance(sec) > 0.5 ? '#000' : '#fff';
            document.getElementById('sim-package').style.backgroundColor = neu;
            document.getElementById('pkg-circle').style.borderColor = sec;
            document.getElementById('pkg-circle').style.color = sec;

            // Strategy Copy
            if (state.strategy === 'editorial') {
                title.innerText = "SOPHISTICATED EDITORIAL";
                narr.innerText = "Emphasis on high-contrast structural elegance. Ideal for premium positioning.";
                adv.innerText = "Strategic Advisory: Low risk, high prestige. The current palette supports luxury market entry with a focus on negative space.";
            } else if (state.strategy === 'modern') {
                title.innerText = "NEO-MODERNIST";
                narr.innerText = "Balanced kinetic energy with grounded neutrals. Versatile across digital interfaces.";
                adv.innerText = "Strategic Advisory: High usability. The luminance distribution ensures accessibility across all standard digital devices.";
            } else {
                title.innerText = "VIBRANT EXPERIMENTAL";
                narr.innerText = "Maximum chromatic impact designed for market disruption and youth engagement.";
                adv.innerText = "Strategic Advisory: High-impact saturation detected. Best suited for transient campaigns and social-first brand identities.";
            }

            // Client Preview Sync
            document.getElementById('preview-palette').innerHTML = '';
            state.palette.forEach(c => {
                const d = document.createElement('div');
                d.style.flex = "1";
                d.style.backgroundColor = c;
                document.getElementById('preview-palette').appendChild(d);
            });
            document.getElementById('preview-headline').style.color = sec;
        }

        function auditAccessibility(c1, c2) {
            const l1 = getLuminance(c1);
            const l2 = getLuminance(c2);
            const ratio = (Math.max(l1, l2) + 0.05) / (Math.min(l1, l2) + 0.05);
            
            const aa = document.getElementById('metric-aa');
            aa.innerText = ratio >= 4.5 ? "PASS" : "FAIL";
            aa.className = ratio >= 4.5 ? "text-green-400" : "text-red-400";
            
            document.getElementById('metric-lum').innerText = Math.round(l1 * 100) + "%";
            document.getElementById('metric-vib').innerText = state.dna.sat > 50 ? "HIGH" : "BALANCED";
        }

        function getLuminance(rgbStr) {
            const [r, g, b] = rgbStr.match(/\d+/g).map(Number);
            const a = [r, g, b].map(v => {
                v /= 255;
                return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
            });
            return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
        }

        function toggleClientMode() {
            const o = document.getElementById('preview-overlay');
            o.classList.toggle('hidden');
            o.classList.toggle('flex');
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        function copyText(txt) {
            const el = document.createElement('textarea');
            el.value = txt;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            
            const tag = document.getElementById('status-tag');
            const prev = tag.innerText;
            tag.innerText = "COPIED";
            setTimeout(() => tag.innerText = prev, 1000);
        }

        function resetEngine() {
            state.images = [];
            state.palette = [];
            document.getElementById('img-previews').innerHTML = '';
            document.getElementById('primary-slots').innerHTML = '<div class="h-32 rounded-2xl bg-white/5 animate-pulse"></div><div class="h-32 rounded-2xl bg-white/5 animate-pulse"></div>';
            document.getElementById('secondary-slots').innerHTML = '<div class="aspect-square rounded-xl bg-white/5 animate-pulse"></div><div class="aspect-square rounded-xl bg-white/5 animate-pulse"></div><div class="aspect-square rounded-xl bg-white/5 animate-pulse"></div>';
            document.getElementById('neutral-slots').innerHTML = '';
            document.getElementById('dna-lum').style.width = '0%';
            document.getElementById('dna-sat').style.width = '0%';
            document.getElementById('dna-geo').style.width = '0%';
            document.getElementById('status-tag').innerText = "IDLE";
            document.getElementById('status-tag').className = "text-[8px] px-2 py-0.5 rounded bg-white/5 border border-white/10 opacity-50";
            document.getElementById('btn-reset').classList.add('hidden');
        }
    </script>
</body>
</html>